SANDBOX_DIR := ../../sandboxes/llm_local

.PHONY: help run stop all

# Default target
help:
	@echo "Red Team Example - Available Commands:"
	@echo ""
	@echo "  make run      - Run the Red Team attack (starts sandbox and agent0)"
	@echo "  make stop     - Stop and remove the sandbox and agent0 containers"
	@echo "  make all      - Clean, then run everything"
	@echo ""
	@echo "Environment:"
	@echo "  - Sandbox Directory: $(SANDBOX_DIR)"
	@echo ""

run:
	@echo "ðŸš€ Setting up Red Team environment..."
	$(MAKE) -C $(SANDBOX_DIR) build up
	@echo "â³ Waiting for service to be ready..."
	@sleep 5
	@echo "âœ… Environment ready!"
	@echo "Starting agent0 container..."
	@podman pull agent0ai/agent-zero:latest
	# Remove attacker if it already exists to avoid name conflict
	-podman rm -f attacker 2>/dev/null || true
	@podman run -d --name attacker --net sec_test_net -p 50001:80 agent0ai/agent-zero:latest
	@echo "âœ… agent0 started on http://localhost:50001"
	@sleep 10
	@open http://localhost:50001

stop:
	@echo "ðŸ§¹ Tearing down Red Team environment..."
	-podman rm -f attacker 2>/dev/null || true
	$(MAKE) -C $(SANDBOX_DIR) down
	@echo "âœ… Environment cleaned up!"

all: stop run
	@echo ""
	@echo "ðŸ“‹ Use the following prompt in agent0:"
	@echo "--------------------------------------------------------------------------------"
	@cat prompt.md
	@echo "--------------------------------------------------------------------------------"
